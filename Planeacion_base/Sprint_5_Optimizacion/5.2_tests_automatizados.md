# Tarea 5.2: Tests Automatizados

## üü° PRIORIDAD MEDIA

## Objetivo
Crear suite de tests para prevenir regresiones.

## Backend Tests

### 1. Unit Tests (pytest)
```python
# tests/test_providers.py
def test_openai_provider_validation():
    config = ProviderConfig(api_key="invalid", model="gpt-4")
    with pytest.raises(ValueError):
        provider = OpenAIProvider(config)

def test_encryption_service():
    text = "secret_api_key"
    encrypted = encryption_service.encrypt(text)
    decrypted = encryption_service.decrypt(encrypted)
    assert text == decrypted
```

### 2. Integration Tests
```python
# tests/test_api.py
def test_create_api_key_endpoint(client):
    response = client.post("/api/api-keys", json={
        "provider": "openai",
        "key_name": "Test Key",
        "api_key": "sk-test123"
    })
    assert response.status_code == 200
```

## Frontend Tests

### 1. Component Tests (Jest + React Testing Library)
```tsx
// __tests__/ProviderSelector.test.tsx
test('renders available providers', async () => {
  render(<ProviderSelector />);
  await waitFor(() => {
    expect(screen.getByText('OpenAI')).toBeInTheDocument();
  });
});
```

### 2. E2E Tests (Playwright)
```typescript
// e2e/settings.spec.ts
test('user can add API key', async ({ page }) => {
  await page.goto('/settings');
  await page.click('text=Add New Key');
  await page.fill('[placeholder="API Key"]', 'sk-test123');
  await page.click('text=Save');
  await expect(page.locator('text=API key agregada')).toBeVisible();
});
```

## Setup

```bash
# Backend
poetry add --dev pytest pytest-asyncio pytest-cov

# Frontend
npm install --save-dev @testing-library/react @testing-library/jest-dom
npm install --save-dev @playwright/test
```

## Criterios de √âxito
- [ ] > 70% code coverage
- [ ] Tests cr√≠ticos path completo
- [ ] CI ejecuta tests autom√°ticamente
- [ ] Tests pasan antes de merge

‚ö†Ô∏è Actualizar PROGRESS.md al completar
